<!DOCTYPE html>
<html>
    <head>
        <title>Testing</title>
        <script src="polymer-paper/platform/platform.js"></script>
        <link href='//fonts.googleapis.com/css?family=RobotoDraft:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en' rel='stylesheet' type='text/css'>

        
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <!--<script src="js/datamaps.world.min.js"></script>-->
        <script src="js/datamaps.all.js"></script>
        
        <script src="js/taffydb/taffy.js"></script>
        
        <script src="js/core-classes.js" type="text/javascript"></script>
        <script src="js/instance-creation.js" type="application/javascript"></script>
        <script src="js/MapViewController.js" type="application/javascript"></script>
        
        <link rel="import" href="polymer-paper/core-toolbar/core-toolbar.html">
        <link rel="import" href="polymer-paper/core-icons/core-icons.html">
        <link rel="import" href="polymer-paper/core-input/core-input.html">
        <link rel="import" href="polymer-paper/paper-shadow/paper-shadow.html">
        
        <link rel="stylesheet" type="text/css" href="css/reset-stylesheet.css">
        <link rel="stylesheet" type="text/css" href="css/main.css">
    </head>

    <body onload="onloadFun()">
        <core-toolbar id="toolbar">
            <paper-shadow z="1"></paper-shadow>
            <a href="product.html"><core-icon id="search-icon" icon="search"></core-icon> </a>
                <core-input id="search-field" placeholder="Search for product ID"></core-input>
           
        </core-toolbar>
        
        <div id="map-container" style="position:relative; height: 600px;"></div>
        
        <div id="info-sidebar" style="background-color:#bbb;"></div>
        
        <script>
            var mvc;
            var map = new Datamaps({
                element: document.getElementById("map-container"),
                fills: {
                    defaultFill: 'rgb(171, 221, 164)',
                    bubbles: 'rgb(0, 0, 180)',
                    highlightedBubble: 'rgb(171,0,0)'
                },
                geographyConfig: {
                    hideAntarctica: false
                },
                projection: 'mercator',
                arcConfig: {
                    strokeColor: '#DD1C77',
                    strokeWidth: 1,
                    arcSharpness: 3,
                    animationSpeed: 600
                }
            });
            
            var zoom = d3.behavior.zoom()
                .translate([0,0])
                .scale(1)
                .scaleExtent([1,8])
                .on("zoom",zoomed);
            map.svg.call(zoom);
            function zoomed () {
                map.svg.select('[class=datamaps-subunits]').attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                map.svg.select('[class=bubbles]').attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                map.svg.select('[class=arc]').attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                console.log(d3.event.translate);
            }
            
            onloadFun = function () {
            //    map.bubbles(testBubbles);
            //    map.arc(testArcs);        
                mvc = new MapViewController();
                var prod = products({name:"MapBook 13\""}).first();
                var arcsnbubbles = mvc.renderProduct(prod);
                map.arc(arcsnbubbles.arcs);
                map.bubbles(arcsnbubbles.bubbles,
                {
                    popupTemplate:
                    function(geo, data) {
                        return '<div class="hoverinfo"><body><table><tr><td><strong>Manufacturer:</strong></td><td>'+ data.name + '</td></tr><tr><td><strong>Product:</strong></td><td>' + data.productName + '</td></tr> </table></div>'}
                });
            }
        </script>
    </body>
</html>