<!DOCTYPE html>
<html>
    <head>
        <title>Testing</title>
        <script src="polymer-paper/platform/platform.js"></script>
        <link href='//fonts.googleapis.com/css?family=RobotoDraft:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en' rel='stylesheet' type='text/css'>

        
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <!--<script src="js/datamaps.world.min.js"></script>-->
        <script src="js/datamaps.all.js"></script>
        
        <script src="js/taffydb/taffy.js"></script>
        
        <script src="js/core-classes.js" type="text/javascript"></script>
        <script src="js/instance-creation.js" type="application/javascript"></script>
        <script src="js/MapViewController.js" type="application/javascript"></script>
        <script src="js/window-resize.js" type="application/javascript"></script>
        
        <link rel="import" href="polymer-paper/core-toolbar/core-toolbar.html">
        <link rel="import" href="polymer-paper/core-icons/core-icons.html">
        <link rel="import" href="polymer-paper/core-input/core-input.html">
        <link rel="import" href="polymer-paper/paper-shadow/paper-shadow.html">
        <link rel="import" href="polymer-paper/core-selector/core-selector.html">
        
        <link rel="stylesheet" type="text/css" href="css/reset-stylesheet.css">
        <link rel="stylesheet" type="text/css" href="css/main.css">
    </head>

    <body onload="onloadFun()" fullbleed vertical layout>
        <core-toolbar id="toolbar">
            <paper-shadow z="1"></paper-shadow>
            <a href="product.html"><core-icon id="search-icon" icon="search" ></core-icon> </a>
            <core-input id="search-field" placeholder="Search for product ID" onkeypress="runScript(event)"></core-input>
            <script>
                function runScript(e) {
                    // if enter key is pressed
                    if (e.keyCode == 13) {
                        var search = document.getElementById('search-field').inputValue;
                        searchProduct(search);
                    }
                }
            </script>
        </core-toolbar>
        <div flex horizontal layout>
            <div id="map-container" flex></div>
            <div id="sidebar">
                <paper-shadow z="1"></paper-shadow>
                <div class="sidebar-banner">
                    <div class="sidebar-icon">
                        <paper-shadow z="1"></paper-shadow>
                        <img class="sidebar-icon" src="images/factory.png">
                    </div>
                    <div class="sidebar-title">
                        <h1 id="sidebar-manufacturer-name">Manufacturer Name</h1>
                        <p id="sidebar-manufacturer-address">Location Adress,<br/>Country</p>
                    </div>
                </div>
                <div class="sidebar-banner">
                    <div class="sidebar-icon">
                        <paper-shadow z="1"></paper-shadow>
                        <img class="sidebar-icon" src="images/laptop.jpg">
                    </div>
                    <div class="sidebar-title">
                        <h1 style="display:inline-block;width:150px" id="sidebar-product-name">Product Name (maybe it is too long for one line)</h1>
                    </div>
                </div>

                <div id="sidebar-stats">
                    <h1>Statistics</h1>
                    <table>
                        <tr>
                            <th>Travelled Distance</th>
                            <td class="data">12000</td>
                            <td> km</td>
                        </tr>
                        <tr>
                            <th>Carbon Footprint</th>
                            <td class="data">3.56</td>
                            <td> kg</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <script>
            var map = new Datamaps({
                element: document.getElementById("map-container"),
                fills: {
                    defaultFill: 'rgb(171, 221, 164)',
                    bubbles: 'rgb(0, 0, 180)',
                    highlightedBubble: 'rgb(171,0,0)'
                },
                geographyConfig: {
                    hideAntarctica: true
                },
                projection: 'mercator',
                arcConfig: {
                    strokeColor: '#DD1C77',
                    strokeWidth: 1,
                    arcSharpness: 3,
                    animationSpeed: 600
                }
            });
            var mvc = new MapViewController();
            
            var zoom = d3.behavior.zoom()
                .translate([0,0])
                .scale(1)
                .scaleExtent([1,8])
                .on("zoom", zoomed);
            map.svg.call(zoom);
            function zoomed () {
                mvc.zoomEvent(d3.event, d3.event);
            }
            
            searchProduct = function (searchstring) {
                console.log(searchstring + " " + products({name:searchstring}).first());
                var prod = products({name:searchstring}).first();
                if(prod != false) {

                    document.getElementById('sidebar-product-name').innerHTML = searchstring;
                    var arcsnbubbles = mvc.renderProduct(prod);
                    map.arc(arcsnbubbles.arcs);
                    map.bubbles(arcsnbubbles.bubbles,
                    {
                        popupTemplate:
                        function(geo, data) {
                            return '<div class="hoverinfo"><body><table><tr><td><strong>Manufacturer:</strong></td><td>'+ data.name + '</td></tr><tr>                               <td><strong>Product:</strong></td><td>' + data.productName + '</td></tr> </table></div>'}
                    });
                }
               
            }
            
            onloadFun = function () {
            //    map.bubbles(testBubbles);
            //    map.arc(testArcs);        
                var prod = products({name:"MapBook 13\""}).first();
                var arcsnbubbles = mvc.renderProduct(prod);
                map.arc(arcsnbubbles.arcs);
                map.bubbles(arcsnbubbles.bubbles,
                {
                    popupTemplate:
                    function(geo, data) {
                        return '<div class="hoverinfo"><body><table><tr><td><strong>Manufacturer:</strong></td><td>'+ data.name + '</td></tr><tr><td><strong>Product:</strong></td><td>' + data.productName + '</td></tr> </table></div>'}
                });
                map.svg
                .attr("width", document.getElementById("map-container").offsetWidth)
                .attr("height",document.getElementById("map-container").offsetHeight);
            }
        </script>
    </body>
</html>